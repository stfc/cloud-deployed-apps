stfc-cloud-openstack-cluster:
  openstack-cluster:
    addons:   
      monitoring:
        enabled: true
        # no need to send alerts around certs/openstack API endpoints K8s clusters
        # ends up with too many messages in the ticket queue and we have other monitoring to track this
        blackboxExporter:
          enabled: false
        lokiStack:
          enabled: false
        kubePrometheusStack:
          release:
            values:
              alertmanager:
                alertmanagerSpec:
                  storage:
                    volumeClaimTemplate:
                      spec:
                        storageClassName: csi-cinder

                enabled: false
                service:
                  type: ClusterIP

                ingress:
                  ingressClassName: nginx
                  enabled: true
                  annotations:
                    cert-manager.io/cluster-issuer: "self-signed"
                  hosts:
                    - alertmanager.example.com
                  paths:
                    - "/"
                  tls:
                    - hosts:
                        - "alertmanager.example.com"
                      secretName: tls-keypair
                  ingressPerReplica:
                    enabled: false
              
              grafana:
                enabled: true

                service:
                  type: ClusterIP

                extraSecretMounts:
                  - name: iris-iam-creds
                    secretName: grafana-iris-iam-creds
                    defaultMode: 0440
                    mountPath: /etc/secrets/iris_iam_creds
                    readOnly: true

                grafana.ini:
                  server: 
                    root_url: grafana.example.com
                  auth.generic_oauth: 
                    enabled: true
                    name: "IRIS IAM"
                    scopes: "openid profile email"
                    auth_url: "https://iris-iam.stfc.ac.uk/authorize"
                    token_url: "https://iris-iam.stfc.ac.uk/token"
                    api_url: "https://iris-iam.stfc.ac.uk/userinfo"
                    groups_attribute_path: "groups[*]"
                    allowed_groups: "stfc-cloud/team,stfc-cloud/admins"
                    client_id: $__file{/etc/secrets/iris_iam_creds/client_id}
                    client_secret: $__file{/etc/secrets/iris_iam_creds/client_secret}
                
                ingress:
                  ingressClassName: nginx
                  enabled: true
                  annotations:
                    cert-manager.io/cluster-issuer: "self-signed"
                  path: /
                  hosts:
                    - grafana.example.com
                  tls:
                    - hosts:
                        - "grafana.example.com"
                      secretName: tls-keypair

              prometheus-operator:
                enabled: true

              prometheus:
                enabled: true
                prometheusSpec:
                  storageSpec:
                    volumeClaimTemplate:
                      spec:
                        storageClassName: csi-cinder
                  externalLabels:
                    cluster: not-set
                    env: not-set

                service:
                  type: ClusterIP

                ingress:
                  ingressClassName: nginx
                  annotations:
                    cert-manager.io/cluster-issuer: "self-signed"
                  enabled: true
                  paths:
                    - /
                  hosts:
                    - prometheus.example.com
                  tls:
                    - hosts:
                        - "prometheus.example.com"
                      secretName: tls-keypair
